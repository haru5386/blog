---
title: 網路怎麼讓資料互相傳？一篇看懂 TCP/IP 四層模型
date: 2025-04-14
category: basics
abstract: 你知道每次開啟網頁、看影片、傳訊息，背後其實都有一套「說話的規則」在運作嗎？這些規則就叫做網路協議（Protocol），而 TCP/IP 是其中最重要的基礎。本篇文章會用「寄信」和「人與人溝通」作為比喻，帶你輕鬆理解 TCP/IP 四層模型，幫助你掌握 HTTP 請求是如何透過網路送達伺服器的，還會解釋 TCP 如何重用連線來提升效能。
tags: [TCP/IP, 網路基礎]
---

### 網路協議（Protocol）是什麼？

你可以把協議想像成不同國家間的外交規則或人與人溝通的語言規則。每個國家的都自己的語言，但為了交流，他們會使用一些通用的語言，比如英文。並且會有一些基本規則，確保溝通的準確性。例如：

- 一個人說話時，另一個人聽
- 使用共同理解的語言
- 使用問候語開始對話
- 告別語結束對話

網路協議的概念也是像這樣，讓不同的電腦系統能夠彼此對話和交換資料。

---

### TCP/IP：網際網路的基礎架構

TCP/IP（傳輸控制協議/網際網路協議）是讓網際網路運作的核心技術組合。這就像是網路世界的通用語言和郵政系統，讓不同電腦能夠相互溝通。
它不是一個單一的協定，而是**一組**協定的集合，用來保證**資料能從一台電腦傳到另一台電腦**，不管它們在哪裡。

他最主要的兩個核心部分是：

- TCP（傳輸控制協議）：確保資料能可靠、完整地傳輸
- IP（網際網路協議）：負責資料要送到何處

雖說主要的概念是這兩個協議，但為了讓資料能更有效地傳輸，還會有其他協議的輔助。

---

#### TCP/IP 的四層模型

我們直接先用表格來看一下：

| 層級                   | 功能                                 | 常見協定                    |
| ---------------------- | ------------------------------------ | --------------------------- |
| 應用層 (Application)   | 提供使用者服務，如瀏覽網頁、寄信等   | HTTP、HTTPS、FTP、SMTP、DNS |
| 傳輸層 (Transport)     | 負責資料的分段、傳送、確認與錯誤檢查 | TCP、UDP                    |
| 網絡層 (Internet)      | 負責路由與 IP 位址的處理             | IP、ICMP、ARP               |
| 實體/網路介面層 (Link) | 和硬體相關，負責實際資料傳輸         | Ethernet、Wi-Fi、PPP        |

##### 我們用更簡單的例子來解釋 TCP/IP 各層的功能，以及它們如何協同工作。

想像你要寄一封信給住在另一個城市的朋友：

###### 1. 應用層（HTTP、HTTPS 等）

就像你寫信的內容。比如「你好嗎？下週我要來你家玩」。這層處理的是「要說什麼」。

- HTTP 就像是一種特定的寫信格式，讓對方知道你是在請求資訊或是分享資訊
- 這就像是人與人之間的溝通方式

###### 2. 傳輸層（TCP、UDP）

就像你把信放進信封，並確保信件完整送達。

**TCP：** 相當於掛號信，會確認對方是否收到，如果對方沒收到會重新寄送。

    - 有「三次握手」確認連接：「我要寄信給你」→「好的，我準備收信了」→「好，我開始寄了」
    - 有「四次揮手」結束連接：「我信寄完了」→「好的，我知道了」→「我也沒什麼要寄了」→「好的，結束了」
    - 會確保信件按順序抵達，不會亂掉

**UDP：** 相當於普通郵件，丟出去就不管了，可能送達也可能不送達，但速度更快。這種傳輸方式多用在遊戲上。

###### 3. 網絡層（IP）

就像在信封上寫地址（IP 地址），確保信件送到正確的城市和建築物。  
負責找路：「從台北到高雄，先走國道一號，再轉國道三號...」。  
當資料要跨越不同網絡時，決定走哪條路徑最合適。

###### 4. 鏈路層（以太網、Wi-Fi 等）

就像實際的交通工具（郵車、火車、飛機）和路徑，負責在物理媒介上傳輸資料。

- 把資料變成電信號、光信號或無線電波在網路線、光纖或空氣中傳遞。
- 處理如何在實體連接的電腦間傳送資料位元。

---

#### 概念都了解後，接下來用前一篇的瀏覽器輸入網址後的過程為例：

1. **DNS 查詢**

- 層級: 應用層 → 傳輸層(UDP) → 網絡層(IP) → 鏈路層
- 處理:

  - 應用層: DNS 協議格式化查詢請求「www.example.com的IP是什麼?」
  - 傳輸層: 通常使用 UDP 協議封裝 DNS 請求（UDP 適合輕量快速的查詢）
  - 網絡層: IP 協議添加 DNS 服務器的 IP 地址
  - 鏈路層: 轉換為電信號或無線電波發送出去

2. **建立 TCP 連接**

- 層級: 傳輸層(TCP) → 網絡層(IP) → 鏈路層
- 處理:

  - 傳輸層: TCP 協議執行三次握手建立連接
  - 網絡層: IP 協議負責找到目標服務器
  - 鏈路層: 實際傳輸數據包

3. **TLS 握手（HTTPS 時）**

- 層級: 應用層(TLS) → 傳輸層(TCP) → 網絡層(IP) → 鏈路層
- 處理:

  - 應用層: TLS 協議處理證書驗證和加密
  - 底層: 通過已建立的 TCP/IP 連接傳輸

4. **HTTP 請求發送**

- 層級: 應用層(HTTP) → 傳輸層(TCP) → 網絡層(IP) → 鏈路層
- 處理:

  - 應用層: HTTP 協議格式化請求「GET / HTTP/1.1」等
  - 傳輸層: TCP 將 HTTP 請求分段、編號、確認傳輸
  - 網絡層: IP 添加路由信息
  - 鏈路層: 物理傳輸

5. **接收 HTTP 響應**

- 層級: 鏈路層 → 網絡層(IP) → 傳輸層(TCP) → 應用層(HTTP)
- 處理:

  - 鏈路層: 接收電信號轉為數據
  - 網絡層: IP 協議檢查地址、重組分片
  - 傳輸層: TCP 重組數據片段、確認完整性
  - 應用層: HTTP 解析響應內容（HTML、CSS 等）

6. **瀏覽器渲染**

- 層級: 瀏覽器內部操作，不涉及網路通訊
- 處理: 解析 HTML、CSS，構建 DOM 樹，渲染頁面

---

### 如何決定使用哪一層處理什麼？
這個決策過程是根據協議設計和標準化規範決定的：

1. **封裝原則**：上層協議的數據總是被封裝在下層協議中

  - HTTP數據→TCP段→IP數據包→鏈路層幀

2. **層級職責**：

  - 應用層：處理特定應用的數據格式和業務邏輯（HTTP、DNS等）
  - 傳輸層：管理端到端通訊（TCP、UDP）
  - 網絡層：處理路由和尋址（IP）
  - 鏈路層：處理物理傳輸

3. **協議頭標識**：每個協議都有特定的頭部信息

  - 例如TCP頭部有源端口、目標端口
  - IP頭部有源IP地址、目標IP地址

4. **端口號**：決定使用哪個應用層協議

  - 80端口→HTTP
  - 443端口→HTTPS
  - 53端口→DNS


**接著我們細看一下，請求和接送的過程，其數據包如何層層封裝與解析：**

1. **應用層**：瀏覽器創建 HTTP 請求「請給我主頁」
  ```p
  GET / HTTP/1.1
  Host: www.example.com
  User-Agent: Mozilla/5.0
  ```
2. **傳輸層**：TCP 將這個請求分割成多個數據包，標記序號，確保可靠傳輸
  ```p
  [TCP頭] (源端口:63245, 目標端口:80, 序列號...)
  [HTTP數據]
  ```
3. **網絡層**：IP 在每個數據包加上目標伺服器的 IP 地址
  ```p
  [IP頭] (源IP:192.168.1.5, 目標IP:93.184.216.34...)
  [TCP頭+HTTP數據]
  ```
4. **鏈路層**：將數據包轉換成電信號，通過網路線傳出
  ```p
  [幀頭] (MAC地址等)
  [IP頭+TCP頭+HTTP數據]
  [幀尾] (校驗等)
  ```

當伺服器收到請求後，同樣通過這四層，但是**反向處理**，層層解封裝得到原始數據：

1. 鏈路層：接收電信號，轉回數據包
2. 網絡層：檢查 IP 地址，確認是發給自己的
3. 傳輸層：TCP 重組所有數據包，確認完整性
4. 應用層：HTTP 解析請求，決定返回什麼網頁內容

然後伺服器的回應（網頁內容）又通過相同的四層返回到你的瀏覽器，**不管瀏覽器、或是伺服器都有接受和發送的功能。**。

![8-1](/images/post/8-1.png)

這就是為什麼說每次網絡通信都必須經過 TCP/IP 的四層，因為每層都有不可或缺的功能。不過，TCP 連接建立後（完成三次握手），可以重複使用這個連接發送多次 HTTP 請求，不需要每次都重新建立連接。

實作上伺服器可透過設定 `keep-alive` 等機制控制 TCP 連線的存活時間。當網頁加載時，前端往往會發出多個 HTTP/HTTPS 請求，這些請求可以共用一條已建立的 TCP 連線（連線重用），避免每次都進行 TCP 三次握手與 TLS 握手，從而提升載入效能並減少延遲。

---

### 總結

我們上一篇有講過，瀏覽器點下去的六步驟，縱觀來看，**TCP/IP 模型就像是網路通訊的基礎建築，而六步驟則是使用這座建築的過程。**
