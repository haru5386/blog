---
title: å‰ç«¯ä¹Ÿè©²æ‡‚çš„è¨­è¨ˆæ¨¡å¼ï¼šå¸¸è¦‹çš„è¡Œç‚ºå‹æ¨¡å¼
date: 2025-04-24
category: basics
abstract: é€™æ¬¡ä»‹ç´¹äº†å¸¸è¦‹çš„ä¸ƒç¨®è¡Œç‚ºå‹æ¨¡å‹ï¼Œè¡Œç‚ºå‹é—œæ³¨çš„æ˜¯æµç¨‹ã€äº¤æ›è¨Šæ¯ã€èª°è² è²¬åšä»€éº¼ã€‚æœ‰å¯èƒ½ä½ å·²ç¶“å¸¸å¸¸å†ç”¨é€™äº›æ¨¡å¼ï¼Œå»ä¸çŸ¥é“é€™äº›æ¨¡å¼æ˜¯ä»€éº¼ï¼Œé€™æ¬¡å¸¶ä½ ä¾†äº†è§£è¡Œç‚ºå‹æ¨¡å‹åœ¨åšä»€éº¼ã€‚
tags: [Design Patternã€ç¨‹å¼æ¶æ§‹ã€ç¨‹å¼ç¢¼ç¶­è­·ã€å‰ç«¯çŸ¥è­˜]
---

- [1. è§€å¯Ÿè€…æ¨¡å¼ (Observer)](#1-è§€å¯Ÿè€…æ¨¡å¼-observer)
- [2. ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternsï¼‰](#2-ç­–ç•¥æ¨¡å¼strategy-patterns)
- [3. å‘½ä»¤æ¨¡å¼ï¼ˆCommand Patternsï¼‰](#3-å‘½ä»¤æ¨¡å¼command-patterns)
- [4. ç‹€æ…‹æ¨¡å¼ï¼ˆState Patternï¼‰](#4-ç‹€æ…‹æ¨¡å¼-state-pattern)
- [5. ä»²ä»‹è€…æ¨¡å¼ï¼ˆMediator patternï¼‰](#5-ä»²ä»‹è€…æ¨¡å¼-mediator-pattern)
- [6. è²¬ä»»éˆæ¨¡å¼ï¼ˆChain of Responsibility Patternï¼‰](#6-è²¬ä»»éˆæ¨¡å¼-chain-of-responsibility-pattern)
- [7. è¿­ä»£å™¨æ¨¡å¼ï¼ˆIterator Patternï¼‰](#7-è¿­ä»£å™¨æ¨¡å¼-iterator-pattern)

---

### è¡Œç‚ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰

> ä½ å¯ä»¥æŠŠå®ƒæƒ³æˆï¼šã€Œç‰©ä»¶ä¹‹é–“è¦æ€éº¼äº’å‹•ã€æºé€šã€çš„æ¨¡å¼ã€‚

ä¸åƒçµæ§‹å‹æ¨¡å¼ï¼ˆåœ¨æ„ç‰©ä»¶ä¹‹é–“æ€éº¼çµ„åˆï¼‰æˆ–å»ºç«‹å‹æ¨¡å¼ï¼ˆåœ¨æ„ç‰©ä»¶æ€éº¼è¢«å‰µå»ºï¼‰ï¼Œè¡Œç‚ºå‹å°±æ˜¯**æ³¨é‡æµç¨‹ã€äº¤æ›è¨Šæ¯ã€èª°è² è²¬åšä»€éº¼ã€‚**

---

### 1. è§€å¯Ÿè€…æ¨¡å¼ (Observer)

é€™å°±åƒæ˜¯è¨‚é–±ä¸€å€‹ YouTube é »é“ï¼šé »é“ï¼ˆè¢«è§€å¯Ÿè€…ï¼‰ç”¢ç”Ÿæ–°å…§å®¹æ™‚ï¼Œæ‰€æœ‰è¨‚é–±è€…ï¼ˆè§€å¯Ÿè€…ï¼‰è‡ªå‹•æ”¶åˆ°é€šçŸ¥ã€‚

```c
// æ–°èç™¼å¸ƒè€…ï¼ˆè¢«è§€å¯Ÿè€…ï¼‰
class NewsPublisher {
  constructor() {
    this.subscribers = []; // å„²å­˜æ‰€æœ‰è¨‚é–±è€…
    this.latestNews = null; // æœ€æ–°æ–°è
  }

  // æ·»åŠ è¨‚é–±è€…
  subscribe(observer) {
    if (!this.subscribers.includes(observer)) {
      this.subscribers.push(observer);
      console.log(`${observer.name} å·²è¨‚é–±æ–°è`);
    }
  }

  // ç§»é™¤è¨‚é–±è€…
  unsubscribe(observer) {
    const index = this.subscribers.indexOf(observer);
    if (index !== -1) {
      this.subscribers.splice(index, 1);
      console.log(`${observer.name} å·²å–æ¶ˆè¨‚é–±`);
    }
  }

  // ç™¼å¸ƒæ–°èä¸¦é€šçŸ¥æ‰€æœ‰è¨‚é–±è€…
  publishNews(news) {
    this.latestNews = news;
    console.log(`ç™¼å¸ƒæ–°è: ${news}`);
    this.notifyAll();
  }

  // é€šçŸ¥æ‰€æœ‰è¨‚é–±è€…
  notifyAll() {
    for (const subscriber of this.subscribers) {
      subscriber.update(this.latestNews);
    }
  }
}

// è¨‚é–±è€…ï¼ˆè§€å¯Ÿè€…ï¼‰
class NewsSubscriber {
  constructor(name) {
    this.name = name;
  }

  // æ”¶åˆ°é€šçŸ¥æ™‚åŸ·è¡Œçš„æ›´æ–°æ–¹æ³•
  update(news) {
    console.log(`${this.name} æ”¶åˆ°æ–°è: ${news}`);
    this.readNews(news);
  }

  // é–±è®€æ–°èçš„å¯¦éš›è¡Œç‚º
  readNews(news) {
    console.log(`${this.name} æ­£åœ¨é–±è®€: "${news}"`);
  }
}

// ä½¿ç”¨ç¯„ä¾‹
const newsChannel = new NewsPublisher();

// å‰µå»ºè¨‚é–±è€…
const john = new NewsSubscriber('ç´„ç¿°');
const mary = new NewsSubscriber('ç‘ªéº—');
const bob = new NewsSubscriber('é®‘ä¼¯');

// æ·»åŠ è¨‚é–±è€…
newsChannel.subscribe(john);
newsChannel.subscribe(mary);
newsChannel.subscribe(bob);

// ç™¼å¸ƒæ–°è
newsChannel.publishNews('å°ç£ä»Šæ—¥æ°£æº«é£†å‡è‡³35åº¦');

// é®‘ä¼¯å–æ¶ˆè¨‚é–±
newsChannel.unsubscribe(bob);

// å†æ¬¡ç™¼å¸ƒæ–°è
newsChannel.publishNews('æ˜æ—¥å°‡æœ‰é¢±é¢¨ä¾†è¥²');
```

##### ç¸½çµä¸€ä¸‹ Observer Pattern çš„ä½¿ç”¨é—œéµ

1. è§£è€¦åˆï¼šç™¼å¸ƒè€…å’Œè¨‚é–±è€…å¯ä»¥ç¨ç«‹è®ŠåŒ–ï¼Œäº’ä¸å½±éŸ¿å°æ–¹çš„å…§éƒ¨å¯¦ç¾
2. å‹•æ…‹é—œä¿‚ï¼šè§€å¯Ÿè€…å¯ä»¥éš¨æ™‚æ·»åŠ æˆ–ç§»é™¤ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹è¢«è§€å¯Ÿè€…çš„ä»£ç¢¼
3. é–‹æ”¾å°é–‰åŸå‰‡ï¼šç³»çµ±å¯ä»¥åœ¨ä¸ä¿®æ”¹ç¾æœ‰ä»£ç¢¼çš„æƒ…æ³ä¸‹å¼•å…¥æ–°çš„è§€å¯Ÿè€…

---

### 2. ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternsï¼‰

åƒæ˜¯åœ¨é»å¤–é€æ™‚é¸æ“‡ä»˜æ¬¾æ–¹å¼ï¼šã€Œä¿¡ç”¨å¡ä»˜æ¬¾ã€æˆ–ã€Œè²¨åˆ°ä»˜æ¬¾ã€æ˜¯å…©ç¨®ç­–ç•¥ã€‚æ ¹æ“šä½ çš„é¸æ“‡ï¼Œç³»çµ±æœƒåšä¸åŒçš„äº‹ï¼Œä½†æœƒæ˜¯ç›¸åŒçš„çµæœï¼ˆéƒ½æœƒæ”¶åˆ°è²¨ï¼‰ã€‚

```c
// æ”¯ä»˜è™•ç†ä¸Šä¸‹æ–‡ (Context)
class PaymentProcessor {
  constructor() {
    this.paymentStrategy = null;
  }

  // è¨­ç½®æ”¯ä»˜ç­–ç•¥
  setPaymentStrategy(paymentStrategy) {
    this.paymentStrategy = paymentStrategy;
  }

  // è™•ç†æ”¯ä»˜
  processPayment(amount) {
    if (!this.paymentStrategy) {
      throw new Error('è«‹å…ˆè¨­ç½®æ”¯ä»˜ç­–ç•¥ï¼');
    }

    return this.paymentStrategy.pay(amount);
  }
}

// ç­–ç•¥æ¥å£ï¼ˆåœ¨ JS ä¸­ä»¥å…±åŒæ–¹æ³•ç´„å®šä»£æ›¿æ¥å£ï¼‰
// æ¯å€‹å…·é«”ç­–ç•¥éƒ½éœ€è¦å¯¦ç¾ pay æ–¹æ³•

// ä¿¡ç”¨å¡æ”¯ä»˜ç­–ç•¥
class CreditCardStrategy {
  constructor(cardNumber, name, cvv, expiryDate) {
    this.cardNumber = cardNumber;
    this.name = name;
    this.cvv = cvv;
    this.expiryDate = expiryDate;
  }

  pay(amount) {
    console.log(`ä½¿ç”¨ä¿¡ç”¨å¡æ”¯ä»˜ ${amount} å…ƒ`);
    console.log(`å¡è™Ÿ: ${this.maskCardNumber()}`);
    return `ä¿¡ç”¨å¡æ”¯ä»˜ ${amount} å…ƒæˆåŠŸ`;
  }

  // éš±è—ä¿¡ç”¨å¡è™Ÿç¢¼ä¸­é–“éƒ¨åˆ†
  maskCardNumber() {
    const last4Digits = this.cardNumber.slice(-4);
    return `**** **** **** ${last4Digits}`;
  }
}

// PayPal æ”¯ä»˜ç­–ç•¥
class PayPalStrategy {
  constructor(email, password) {
    this.email = email;
    this.password = password;
  }

  pay(amount) {
    console.log(`ä½¿ç”¨ PayPal æ”¯ä»˜ ${amount} å…ƒ`);
    console.log(`PayPal å¸³è™Ÿ: ${this.email}`);
    return `PayPal æ”¯ä»˜ ${amount} å…ƒæˆåŠŸ`;
  }
}

// è¡Œå‹•æ”¯ä»˜ç­–ç•¥
class MobilePayStrategy {
  constructor(phoneNumber) {
    this.phoneNumber = phoneNumber;
  }

  pay(amount) {
    console.log(`ä½¿ç”¨è¡Œå‹•æ”¯ä»˜å®Œæˆ ${amount} å…ƒäº¤æ˜“`);
    console.log(`æ‰‹æ©Ÿè™Ÿç¢¼: ${this.formatPhoneNumber()}`);
    return `è¡Œå‹•æ”¯ä»˜ ${amount} å…ƒæˆåŠŸ`;
  }

  // æ ¼å¼åŒ–é›»è©±è™Ÿç¢¼ï¼Œåªé¡¯ç¤ºéƒ¨åˆ†æ•¸å­—
  formatPhoneNumber() {
    return `${this.phoneNumber.slice(0, 3)}****${this.phoneNumber.slice(-3)}`;
  }
}

// ä½¿ç”¨ç¯„ä¾‹
const paymentProcessor = new PaymentProcessor();

// å®¢æˆ¶é¸æ“‡ä¿¡ç”¨å¡æ”¯ä»˜
const creditCardPayment = new CreditCardStrategy('1234567890123456', 'å¼µä¸‰', '123', '12/25');
paymentProcessor.setPaymentStrategy(creditCardPayment);
console.log(paymentProcessor.processPayment(2000));

console.log('------------------------');

// å®¢æˆ¶åˆ‡æ›åˆ° PayPal æ”¯ä»˜
const paypalPayment = new PayPalStrategy('user@example.com', 'password');
paymentProcessor.setPaymentStrategy(paypalPayment);
console.log(paymentProcessor.processPayment(1500));

console.log('------------------------');

// å®¢æˆ¶åˆ‡æ›åˆ°è¡Œå‹•æ”¯ä»˜
const mobilePayment = new MobilePayStrategy('0912345678');
paymentProcessor.setPaymentStrategy(mobilePayment);
console.log(paymentProcessor.processPayment(800));

// è¼¸å‡ºçµæœï¼š
// ä½¿ç”¨ä¿¡ç”¨å¡æ”¯ä»˜ 2000 å…ƒ
// å¡è™Ÿ: **** **** **** 3456
// ä¿¡ç”¨å¡æ”¯ä»˜ 2000 å…ƒæˆåŠŸ
// ------------------------
// ä½¿ç”¨ PayPal æ”¯ä»˜ 1500 å…ƒ
// PayPal å¸³è™Ÿ: user@example.com
// PayPal æ”¯ä»˜ 1500 å…ƒæˆåŠŸ
// ------------------------
// ä½¿ç”¨è¡Œå‹•æ”¯ä»˜å®Œæˆ 800 å…ƒäº¤æ˜“
// æ‰‹æ©Ÿè™Ÿç¢¼: 091****678
// è¡Œå‹•æ”¯ä»˜ 800 å…ƒæˆåŠŸ
```

##### ç¸½çµä¸€ä¸‹ Observer Pattern çš„ä½¿ç”¨é—œéµ

1. æ¶ˆé™¤æ¢ä»¶åˆ¤æ–·ï¼šé¿å…è¤‡é›œçš„ if-else æˆ– switch èªå¥ï¼Œä½¿ä»£ç¢¼æ›´ç°¡æ½”æ¸…æ™°
2. é–‹æ”¾å°é–‰åŸå‰‡ï¼šå¯ä»¥è¼•é¬†æ·»åŠ æ–°çš„ç­–ç•¥è€Œä¸éœ€è¦ä¿®æ”¹ç¾æœ‰ä»£ç¢¼
3. é‹è¡Œæ™‚é¸æ“‡ï¼šå¯ä»¥æ ¹æ“šç”¨æˆ¶æ“ä½œæˆ–ç³»çµ±ç‹€æ…‹å‹•æ…‹åˆ‡æ›ç­–ç•¥
4. åˆ†é›¢é—œæ³¨é»ï¼šæ¯å€‹ç­–ç•¥å°ˆæ³¨æ–¼è‡ªå·±çš„å¯¦ç¾ï¼Œä¸éœ€è¦äº†è§£å…¶ä»–ç­–ç•¥çš„ç´°ç¯€

---

### 3. å‘½ä»¤æ¨¡å¼ï¼ˆCommand Patternsï¼‰

ä½ ä¸ç›´æ¥å«ç‡ˆæ‰“é–‹ï¼Œè€Œæ˜¯å¯«ä¸€å¼µã€Œæ‰“é–‹ç‡ˆã€çš„æŒ‡ä»¤äº¤çµ¦åŠ©ç†ï¼ˆé™æ§å™¨ï¼‰ï¼ŒåŠ©ç†ç…§åšã€‚é€™æ¨£å¥½è™•æ˜¯ï¼šä½ å¯ä»¥å„²å­˜ã€æ’ç¨‹ã€æˆ–é‡åš/å›å¾©æŒ‡ä»¤ã€‚

å‘½ä»¤æ¨¡å¼çš„æœƒæœ‰å¹¾å€‹è§’è‰²

1. å‘½ä»¤ï¼ˆCommandï¼‰ï¼šå°è£äº†å‹•ä½œåŠå…¶åƒæ•¸çš„å°è±¡
2. æ¥æ”¶è€…ï¼ˆReceiverï¼‰ï¼šå¯¦éš›åŸ·è¡Œå‘½ä»¤çš„å°è±¡ï¼Œä¾‹å¦‚ï¼šé›»è¦–ã€å†·æ°£..
3. èª¿ç”¨è€…ï¼ˆInvokerï¼‰ï¼šè¦æ±‚å‘½ä»¤åŸ·è¡Œè«‹æ±‚çš„å°è±¡ï¼Œä¾‹å¦‚ï¼šé™æ§å™¨
4. å®¢æˆ¶ç«¯ï¼ˆClientï¼‰ï¼šå‰µå»ºå‘½ä»¤ä¸¦è¨­å®šæ¥æ”¶è€…ï¼Œä¾‹å¦‚ï¼šä½¿ç”¨è€…

```c
// æ¥æ”¶è€…é¡ - æ™ºèƒ½å®¶é›»
class SmartLight {
  constructor(location) {
    this.location = location;
    this.isOn = false;
    this.brightness = 0;
  }

  turnOn() {
    this.isOn = true;
    this.brightness = 100;
    console.log(`${this.location}çš„ç‡ˆå·²æ‰“é–‹ï¼Œäº®åº¦ï¼š${this.brightness}%`);
  }

  turnOff() {
    this.isOn = false;
    this.brightness = 0;
    console.log(`${this.location}çš„ç‡ˆå·²é—œé–‰`);
  }

  dimLight(level) {
    if (!this.isOn) {
      this.turnOn();
    }
    this.brightness = level;
    console.log(`${this.location}çš„ç‡ˆäº®åº¦èª¿æ•´ç‚ºï¼š${this.brightness}%`);
  }
}

class SmartTV {
  constructor(location) {
    this.location = location;
    this.isOn = false;
    this.channel = 1;
    this.volume = 50;
  }

  turnOn() {
    this.isOn = true;
    console.log(`${this.location}çš„é›»è¦–å·²æ‰“é–‹ï¼Œç•¶å‰é »é“ï¼š${this.channel}ï¼ŒéŸ³é‡ï¼š${this.volume}`);
  }

  turnOff() {
    this.isOn = false;
    console.log(`${this.location}çš„é›»è¦–å·²é—œé–‰`);
  }

  changeChannel(channel) {
    if (!this.isOn) {
      this.turnOn();
    }
    this.channel = channel;
    console.log(`${this.location}çš„é›»è¦–åˆ‡æ›åˆ°é »é“ ${this.channel}`);
  }

  adjustVolume(volume) {
    if (!this.isOn) {
      this.turnOn();
    }
    this.volume = volume;
    console.log(`${this.location}çš„é›»è¦–éŸ³é‡èª¿æ•´ç‚º ${this.volume}`);
  }
}

// å‘½ä»¤æ¥å£
class Command {
  execute() {
    throw new Error('å­é¡å¿…é ˆå¯¦ç¾ execute æ–¹æ³•');
  }

  undo() {
    throw new Error('å­é¡å¿…é ˆå¯¦ç¾ undo æ–¹æ³•');
  }
}

// å…·é«”å‘½ä»¤ - ç‡ˆå…‰ç›¸é—œ
class TurnLightOnCommand extends Command {
  constructor(light) {
    super();
    this.light = light;
    this.previousState = { isOn: light.isOn, brightness: light.brightness };
  }

  execute() {
    this.previousState = { isOn: this.light.isOn, brightness: this.light.brightness };
    this.light.turnOn();
  }

  undo() {
    if (this.previousState.isOn) {
      this.light.dimLight(this.previousState.brightness);
    } else {
      this.light.turnOff();
    }
  }
}

class TurnLightOffCommand extends Command {
  constructor(light) {
    super();
    this.light = light;
    this.previousState = { isOn: light.isOn, brightness: light.brightness };
  }

  execute() {
    this.previousState = { isOn: this.light.isOn, brightness: this.light.brightness };
    this.light.turnOff();
  }

  undo() {
    if (this.previousState.isOn) {
      this.light.turnOn();
      this.light.dimLight(this.previousState.brightness);
    }
  }
}

class DimLightCommand extends Command {
  constructor(light, level) {
    super();
    this.light = light;
    this.level = level;
    this.previousLevel = light.brightness;
  }

  execute() {
    this.previousLevel = this.light.brightness;
    this.light.dimLight(this.level);
  }

  undo() {
    this.light.dimLight(this.previousLevel);
  }
}

// å…·é«”å‘½ä»¤ - é›»è¦–ç›¸é—œ
class TurnTVOnCommand extends Command {
  constructor(tv) {
    super();
    this.tv = tv;
  }

  execute() {
    this.tv.turnOn();
  }

  undo() {
    this.tv.turnOff();
  }
}

class TurnTVOffCommand extends Command {
  constructor(tv) {
    super();
    this.tv = tv;
    this.previousState = {
      isOn: tv.isOn,
      channel: tv.channel,
      volume: tv.volume
    };
  }

  execute() {
    this.previousState = {
      isOn: this.tv.isOn,
      channel: this.tv.channel,
      volume: this.tv.volume
    };
    this.tv.turnOff();
  }

  undo() {
    if (this.previousState.isOn) {
      this.tv.turnOn();
      this.tv.changeChannel(this.previousState.channel);
      this.tv.adjustVolume(this.previousState.volume);
    }
  }
}

class ChangeChannelCommand extends Command {
  constructor(tv, channel) {
    super();
    this.tv = tv;
    this.channel = channel;
    this.previousChannel = tv.channel;
  }

  execute() {
    this.previousChannel = this.tv.channel;
    this.tv.changeChannel(this.channel);
  }

  undo() {
    this.tv.changeChannel(this.previousChannel);
  }
}

// è¤‡åˆå‘½ä»¤ - å ´æ™¯æ¨¡å¼
class SceneModeCommand extends Command {
  constructor(commands) {
    super();
    this.commands = commands;
    this.executedCommands = [];
  }

  execute() {
    // è¨˜éŒ„å·²åŸ·è¡Œçš„å‘½ä»¤ï¼Œç”¨æ–¼æ’¤éŠ·
    this.executedCommands = [];
    for (const command of this.commands) {
      command.execute();
      this.executedCommands.push(command);
    }
  }

  undo() {
    // åå‘æ’¤éŠ·å‘½ä»¤
    for (let i = this.executedCommands.length - 1; i >= 0; i--) {
      this.executedCommands[i].undo();
    }
  }
}

// èª¿ç”¨è€… - é™æ§å™¨
class RemoteControl {
  constructor() {
    this.commands = [];
    this.commandHistory = [];
  }

  setCommand(slot, command) {
    this.commands[slot] = command;
  }

  pressButton(slot) {
    if (this.commands[slot]) {
      this.commands[slot].execute();
      this.commandHistory.push(this.commands[slot]);
    }
  }

  pressUndoButton() {
    const command = this.commandHistory.pop();
    if (command) {
      console.log('æ’¤éŠ·ä¸Šä¸€å€‹æ“ä½œ...');
      command.undo();
    } else {
      console.log('æ²’æœ‰å¯æ’¤éŠ·çš„æ“ä½œ');
    }
  }

  executeSequence(commands) {
    for (const command of commands) {
      command.execute();
      this.commandHistory.push(command);
    }
  }
}

// å®¢æˆ¶ç«¯ä»£ç¢¼
// å‰µå»ºæ¥æ”¶è€…
const livingRoomLight = new SmartLight('å®¢å»³');
const bedroomLight = new SmartLight('è‡¥å®¤');
const kitchenLight = new SmartLight('å»šæˆ¿');
const livingRoomTV = new SmartTV('å®¢å»³');

// å‰µå»ºå‘½ä»¤
const livingRoomLightOn = new TurnLightOnCommand(livingRoomLight);
const livingRoomLightOff = new TurnLightOffCommand(livingRoomLight);
const livingRoomLightDim = new DimLightCommand(livingRoomLight, 30);
const bedroomLightOn = new TurnLightOnCommand(bedroomLight);
const bedroomLightOff = new TurnLightOffCommand(bedroomLight);
const kitchenLightOn = new TurnLightOnCommand(kitchenLight);
const kitchenLightOff = new TurnLightOffCommand(kitchenLight);
const tvOn = new TurnTVOnCommand(livingRoomTV);
const tvOff = new TurnTVOffCommand(livingRoomTV);
const tvChangeChannel = new ChangeChannelCommand(livingRoomTV, 8);

// å‰µå»ºå ´æ™¯æ¨¡å¼
const movieMode = new SceneModeCommand([
  livingRoomLightDim,
  tvOn,
  tvChangeChannel
]);

const sleepMode = new SceneModeCommand([
  livingRoomLightOff,
  tvOff,
  kitchenLightOff,
  bedroomLightOn
]);

// è¨­ç½®é™æ§å™¨
const remote = new RemoteControl();
remote.setCommand(0, livingRoomLightOn);
remote.setCommand(1, livingRoomLightOff);
remote.setCommand(2, bedroomLightOn);
remote.setCommand(3, bedroomLightOff);
remote.setCommand(4, kitchenLightOn);
remote.setCommand(5, kitchenLightOff);
remote.setCommand(6, tvOn);
remote.setCommand(7, tvOff);
remote.setCommand(8, movieMode);
remote.setCommand(9, sleepMode);

// ä½¿ç”¨é™æ§å™¨
console.log('=== ä½¿ç”¨æ™ºèƒ½å®¶å±…ç³»çµ± ===');
console.log('æ‰“é–‹å®¢å»³ç‡ˆ');
remote.pressButton(0);

console.log('\nèª¿æš—å®¢å»³ç‡ˆ');
remote.pressButton(1);
remote.pressUndoButton();

console.log('\né–‹å•Ÿé›»å½±æ¨¡å¼');
remote.pressButton(8);

console.log('\næ’¤éŠ·é›»å½±æ¨¡å¼');
remote.pressUndoButton();

console.log('\næº–å‚™ç¡è¦º');
remote.pressButton(9);
```

##### ç¸½çµä¸€ä¸‹ Command Pattern çš„ä½¿ç”¨é—œéµ

1. è§£è€¦è«‹æ±‚è€…å’Œå¯¦ç¾è€…ï¼šç™¼å‡ºå‘½ä»¤çš„å°è±¡å’ŒåŸ·è¡Œå‘½ä»¤çš„å°è±¡å®Œå…¨åˆ†é›¢
2. å¯æ“´å±•æ€§ï¼šè¼•é¬†æ·»åŠ æ–°å‘½ä»¤è€Œä¸å½±éŸ¿ç¾æœ‰ä»£ç¢¼
3. çµ„åˆå‘½ä»¤ï¼šå¯ä»¥å°‡å¤šå€‹å‘½ä»¤çµ„åˆæˆä¸€å€‹è¤‡åˆå‘½ä»¤ï¼ˆå®å‘½ä»¤ï¼‰
4. æ”¯æŒæ’¤éŠ·/é‡åšï¼šå‘½ä»¤å¯ä»¥ä¿å­˜ç‹€æ…‹ï¼Œå¯¦ç¾æ’¤éŠ·åŠŸèƒ½
5. å‘½ä»¤æ—¥èªŒï¼šå¯ä»¥è¨˜éŒ„æ‰€æœ‰å‘½ä»¤ï¼Œå¯¦ç¾æ—¥èªŒè¨˜éŒ„å’Œæ¢å¾©ç³»çµ±

---

### 4. ç‹€æ…‹æ¨¡å¼ï¼ˆState Patternï¼‰

å¯ä»¥æŠŠå®ƒæƒ³åƒæˆä¸€å€‹äººæœ‰å¤šç¨®ã€Œç‹€æ…‹ã€ï¼Œæ¯ç¨®ç‹€æ…‹ä¸‹ï¼Œåšå‡ºä¾†çš„è¡Œç‚ºæœƒä¸ä¸€æ¨£ã€‚ä½ è‚šå­é¤“çš„æ™‚å€™ï¼ˆHungryï¼‰ï¼Œçœ‹åˆ°ç‚¸é›æœƒé¦¬ä¸Šåƒã€ä½ é£½çš„æ™‚å€™ï¼ˆFullï¼‰ï¼Œçœ‹åˆ°ç‚¸é›æœƒèªªã€Œç®—äº†â€¦ç­‰ä¸€ä¸‹å§ã€ã€ä½ ç”Ÿç—…çš„æ™‚å€™ï¼ˆSickï¼‰ï¼Œçœ‹åˆ°ç‚¸é›æœƒèªªã€Œæˆ‘ä¸èƒ½åƒæ²¹ç‚¸çš„â€¦ã€

è€Œ State Pattern å°±æ˜¯åœ¨ç®¡ç†é€™äº›ä¸åŒçš„ç‹€æ…‹å’Œå°æ‡‰çš„è¡Œç‚ºã€‚

æˆ‘å€‘èˆ‰ä¾‹ä¾†èªªï¼Œé€™å°é£²æ–™è²©è³£æ©Ÿæœ‰å¹¾ç¨®ç‹€æ…‹ï¼šç­‰å¾…æŠ•å…¥éŒ¢ï¼ˆIdleStateï¼‰ã€æœ‰éŒ¢äº†ï¼ˆHasMoneyStateï¼‰ã€ç¼ºæ–™ä¸èƒ½å‡ºè²¨ï¼ˆOutOfStockStateï¼‰ï¼Œç•¶ä½ å°è²©è³£æ©Ÿå‘¼å« pressButton() æ™‚ï¼Œä¸åŒç‹€æ…‹æœƒæœ‰ä¸åŒè¡Œç‚ºã€‚

```c
// ç‹€æ…‹åŸºåº•ï¼ˆæ¯å€‹ç‹€æ…‹éƒ½è¦å¯¦ä½œé€™å€‹ä»‹é¢ï¼‰
class State {
  insertCoin() {}
  pressButton() {}
}

// 1. æ²’æœ‰éŒ¢çš„ç‹€æ…‹
class IdleState extends State {
  constructor(machine) {
    super();
    this.machine = machine;
  }

  insertCoin() {
    console.log("ğŸª™ æŠ•å¹£æˆåŠŸï¼");
    this.machine.setState(this.machine.hasMoneyState);
  }

  pressButton() {
    console.log("âŒ è«‹å…ˆæŠ•å¹£ï¼");
  }
}

// 2. æœ‰éŒ¢çš„ç‹€æ…‹
class HasMoneyState extends State {
  constructor(machine) {
    super();
    this.machine = machine;
  }

  insertCoin() {
    console.log("âš ï¸ å·²ç¶“æŠ•å¹£äº†ï¼Œä¸ç”¨å†æŠ•ï¼");
  }

  pressButton() {
    if (this.machine.stock > 0) {
      console.log("ğŸ¥¤ çµ¦ä½ ä¸€æ¯çå¥¶ï¼");
      this.machine.stock--;
      this.machine.setState(this.machine.idleState);
    } else {
      console.log("ğŸš« æ²’æœ‰å­˜è²¨äº†ï¼Œé€€æ¬¾ï¼");
      this.machine.setState(this.machine.outOfStockState);
    }
  }
}

// 3. ç¼ºè²¨çš„ç‹€æ…‹
class OutOfStockState extends State {
  constructor(machine) {
    super();
    this.machine = machine;
  }

  insertCoin() {
    console.log("ğŸš« ç¼ºè²¨ä¸­ï¼Œä¸èƒ½æŠ•å¹£");
  }

  pressButton() {
    console.log("ğŸš« ç¼ºè²¨ä¸­ï¼ŒæŒ‰ä¹Ÿæ²’ç”¨");
  }
}

// è²©è³£æ©Ÿæœ¬é«”

class BubbleTeaMachine {
  constructor(stock = 1) {
    this.idleState = new IdleState(this);
    this.hasMoneyState = new HasMoneyState(this);
    this.outOfStockState = new OutOfStockState(this);

    this.state = stock > 0 ? this.idleState : this.outOfStockState;
    this.stock = stock;
  }

  setState(state) {
    this.state = state;
  }

  insertCoin() {
    this.state.insertCoin();
  }

  pressButton() {
    this.state.pressButton();
  }
}

// å¯¦éš›æ“ä½œ
const machine = new BubbleTeaMachine(2);

machine.pressButton(); // âŒ è«‹å…ˆæŠ•å¹£ï¼
machine.insertCoin();  // ğŸª™ æŠ•å¹£æˆåŠŸï¼
machine.pressButton(); // ğŸ¥¤ çµ¦ä½ ä¸€æ¯çå¥¶ï¼

machine.insertCoin();  // ğŸª™ æŠ•å¹£æˆåŠŸï¼
machine.pressButton(); // ğŸ¥¤ çµ¦ä½ ä¸€æ¯çå¥¶ï¼ï¼ˆé€™æ˜¯æœ€å¾Œä¸€æ¯ï¼‰

machine.insertCoin();  // ğŸš« ç¼ºè²¨ä¸­ï¼Œä¸èƒ½æŠ•å¹£
machine.pressButton(); // ğŸš« ç¼ºè²¨ä¸­ï¼ŒæŒ‰ä¹Ÿæ²’ç”¨
```

##### ç¸½çµä¸€ä¸‹ State Pattern çš„ä½¿ç”¨é—œéµ

1. **æ¶ˆé™¤é¾å¤§çš„æ¢ä»¶åˆ†æ”¯**ï¼šä¸éœ€è¦å¤§é‡çš„ if-else æˆ– switch ä¾†è™•ç†ä¸åŒç‹€æ…‹ï¼Œæ¯å€‹ç‹€æ…‹éƒ½è¢«å°è£åœ¨ç¨ç«‹çš„é¡ä¸­
2. **å–®ä¸€è·è²¬åŸå‰‡**ï¼šæ¯å€‹ç‹€æ…‹é¡åªé—œæ³¨ç‰¹å®šç‹€æ…‹ä¸‹çš„è¡Œç‚º
3. **é–‹æ”¾å°é–‰åŸå‰‡**ï¼šå¯ä»¥è¼•é¬†æ·»åŠ æ–°çš„ç‹€æ…‹è€Œä¸ä¿®æ”¹ç¾æœ‰ä»£ç¢¼
4. **ç‹€æ…‹è½‰æ›çš„é¡¯å¼åŒ–**ï¼šç‹€æ…‹ä¹‹é–“çš„è½‰æ›é—œä¿‚æ˜ç¢ºå¯è¦‹ï¼Œä¾¿æ–¼ç†è§£å’Œç¶­è­·
5. **ç‹€æ…‹è¡Œç‚ºçš„ä¸€è‡´æ€§**ï¼šç¢ºä¿åœ¨ç‰¹å®šç‹€æ…‹ä¸‹çš„æ‰€æœ‰è¡Œç‚ºä¿æŒä¸€è‡´

---

### 5. ä»²ä»‹è€…æ¨¡å¼ï¼ˆMediator patternï¼‰

> æŠŠä¸€ç¾¤ç‰©ä»¶ä¹‹é–“çš„æºé€šï¼Œçµ±ä¸€äº¤çµ¦ä¸€å€‹ä¸­ä»‹è™•ç†ï¼Œæ¸›å°‘è€¦åˆã€‚

æƒ³åƒä¸€ä¸‹ï¼Œå¦‚æœä½ åœ¨ä¸€å€‹èŠå¤©å®¤è£¡ï¼Œæœ‰ 5 å€‹äººï¼Œæ¯å€‹äººè¦ç§è¨Šå…¶ä»–äººï¼Œå°±è¦çŸ¥é“å°æ–¹æ˜¯èª°ã€æ€éº¼è¯çµ¡ï¼Œç¨‹å¼è£¡å°±æ˜¯ä¸€å †ã€ŒA å‚³çµ¦ Bã€ã€ã€ŒB å›çµ¦ Cã€ï¼Œå¾ˆäº‚ã€‚

ä½†å¦‚æœæœ‰ä¸€å€‹ã€Œç¾¤çµ„ç®¡ç†å“¡ã€ï¼ˆMediatorï¼‰ï¼Œå¤§å®¶åªè¦è·Ÿä»–è¬›ï¼šã€Œå¹«æˆ‘é€šçŸ¥ä¸€ä¸‹èª°èª°èª°ã€ï¼Œæ•´å€‹æºé€šå°±ç°¡å–®å¾ˆå¤šï¼Œå½¼æ­¤ä¹‹é–“ä¸éœ€è¦çŸ¥é“å°æ–¹ï¼Œåªè¦è·Ÿã€Œä¸­é–“äººã€æ‰“äº¤é“å°±å¥½ã€‚

èˆ‰ä¾‹ä¾†èªªï¼šæˆ‘å€‘åœ¨èŠå¤©å®¤å‚³è¨Šæ¯ï¼Œæ¯å€‹äººéƒ½æ˜¯ä¸€å€‹ Userï¼Œä»–å€‘ä¸ç›´æ¥å‚³è¨Šæ¯çµ¦å½¼æ­¤ï¼Œè€Œæ˜¯é€šé€šäº¤çµ¦ ChatRoomï¼ˆä»²ä»‹è€…ï¼‰ä¾†è½‰é”

```c
// ä»²ä»‹è€…æ¥å£
class ChatMediator {
  sendMessage(message, sender) {
    throw new Error('å­é¡å¿…é ˆå¯¦ç¾ sendMessage æ–¹æ³•');
  }

  addUser(user) {
    throw new Error('å­é¡å¿…é ˆå¯¦ç¾ addUser æ–¹æ³•');
  }

  removeUser(user) {
    throw new Error('å­é¡å¿…é ˆå¯¦ç¾ removeUser æ–¹æ³•');
  }
}

// å…·é«”ä»²ä»‹è€…ï¼šèŠå¤©å®¤
class ChatRoom extends ChatMediator {
  constructor(name) {
    super();
    this.name = name;
    this.users = [];
    this.messageHistory = [];

    console.log(`èŠå¤©å®¤ "${this.name}" å·²å‰µå»º`);
  }

  // æ·»åŠ ç”¨æˆ¶åˆ°èŠå¤©å®¤
  addUser(user) {
    this.users.push(user);
    console.log(`ç”¨æˆ¶ ${user.name} åŠ å…¥èŠå¤©å®¤ "${this.name}"`);
    this.broadcastSystemMessage(`${user.name} åŠ å…¥äº†èŠå¤©å®¤`);
  }

  // å¾èŠå¤©å®¤ç§»é™¤ç”¨æˆ¶
  removeUser(user) {
    const index = this.users.indexOf(user);
    if (index !== -1) {
      this.users.splice(index, 1);
      console.log(`ç”¨æˆ¶ ${user.name} é›¢é–‹èŠå¤©å®¤ "${this.name}"`);
      this.broadcastSystemMessage(`${user.name} é›¢é–‹äº†èŠå¤©å®¤`);
    }
  }

  // ç™¼é€æ¶ˆæ¯
  sendMessage(message, sender) {
    // ä¿å­˜æ¶ˆæ¯è¨˜éŒ„
    const timestamp = new Date().toLocaleTimeString();
    const formattedMessage = `[${timestamp}] ${sender.name}: ${message}`;
    this.messageHistory.push(formattedMessage);

    // å°‡æ¶ˆæ¯ç™¼é€çµ¦æ‰€æœ‰ç”¨æˆ¶ï¼ˆé™¤äº†ç™¼é€è€…ï¼‰
    this.users.forEach(user => {
      if (user !== sender) {
        user.receiveMessage(message, sender);
      }
    });
  }

  // ç™¼é€ç§èŠæ¶ˆæ¯
  sendPrivateMessage(message, sender, receiver) {
    const timestamp = new Date().toLocaleTimeString();
    const formattedMessage = `[${timestamp}] ${sender.name} ç§èŠçµ¦ ${receiver.name}: ${message}`;
    this.messageHistory.push(formattedMessage);

    // åªç™¼é€çµ¦ç‰¹å®šæ¥æ”¶è€…
    const targetUser = this.users.find(user => user === receiver);
    if (targetUser) {
      targetUser.receivePrivateMessage(message, sender);
    } else {
      sender.receiveSystemMessage(`ç”¨æˆ¶ ${receiver.name} ä¸å­˜åœ¨æˆ–å·²é›¢é–‹èŠå¤©å®¤`);
    }
  }

  // ç™¼é€ç³»çµ±æ¶ˆæ¯çµ¦æ‰€æœ‰ç”¨æˆ¶
  broadcastSystemMessage(message) {
    const timestamp = new Date().toLocaleTimeString();
    const formattedMessage = `[${timestamp}] [ç³»çµ±]: ${message}`;
    this.messageHistory.push(formattedMessage);

    this.users.forEach(user => {
      user.receiveSystemMessage(message);
    });
  }

  // åˆ—å‡ºæ‰€æœ‰åœ¨ç·šç”¨æˆ¶
  listUsers() {
    return this.users.map(user => user.name);
  }

  // ç²å–æ¶ˆæ¯æ­·å²
  getMessageHistory() {
    return this.messageHistory;
  }
}

// çµ„ä»¶åŸºç¤é¡ï¼šç”¨æˆ¶
class User {
  constructor(name) {
    this.name = name;
    this.chatMediator = null;
  }

  // è¨­ç½®ä»²ä»‹è€…
  setChatMediator(mediator) {
    this.chatMediator = mediator;
  }

  // ç™¼é€è¨Šæ¯
  send(message) {
    if (!this.chatMediator) {
      console.log(`${this.name}: å°šæœªåŠ å…¥èŠå¤©å®¤`);
      return;
    }

    console.log(`${this.name} ç™¼é€è¨Šæ¯: ${message}`);
    this.chatMediator.sendMessage(message, this);
  }

  // ç™¼é€ç§èŠæ¶ˆæ¯
  sendPrivate(message, receiverName) {
    if (!this.chatMediator) {
      console.log(`${this.name}: å°šæœªåŠ å…¥èŠå¤©å®¤`);
      return;
    }

    // æ‰¾åˆ°æ¥æ”¶è€…
    const receiver = this.chatMediator.users.find(user => user.name === receiverName);
    if (receiver) {
      console.log(`${this.name} ç™¼é€ç§èŠè¨Šæ¯çµ¦ ${receiverName}: ${message}`);
      this.chatMediator.sendPrivateMessage(message, this, receiver);
    } else {
      console.log(`${this.name}: æ‰¾ä¸åˆ°ç”¨æˆ¶ ${receiverName}`);
    }
  }

  // æ¥æ”¶è¨Šæ¯
  receiveMessage(message, sender) {
    console.log(`${this.name} æ”¶åˆ°ä¾†è‡ª ${sender.name} çš„è¨Šæ¯: ${message}`);
  }

  // æ¥æ”¶ç§èŠæ¶ˆæ¯
  receivePrivateMessage(message, sender) {
    console.log(`${this.name} æ”¶åˆ°ä¾†è‡ª ${sender.name} çš„ç§èŠè¨Šæ¯: ${message}`);
  }

  // æ¥æ”¶ç³»çµ±æ¶ˆæ¯
  receiveSystemMessage(message) {
    console.log(`${this.name} æ”¶åˆ°ç³»çµ±è¨Šæ¯: ${message}`);
  }

  // æŸ¥çœ‹åœ¨ç·šç”¨æˆ¶
  viewOnlineUsers() {
    if (!this.chatMediator) {
      console.log(`${this.name}: å°šæœªåŠ å…¥èŠå¤©å®¤`);
      return [];
    }

    const users = this.chatMediator.listUsers();
    console.log(`${this.name} æŸ¥çœ‹åœ¨ç·šç”¨æˆ¶: ${users.join(', ')}`);
    return users;
  }

  // æŸ¥çœ‹æ¶ˆæ¯æ­·å²
  viewMessageHistory() {
    if (!this.chatMediator) {
      console.log(`${this.name}: å°šæœªåŠ å…¥èŠå¤©å®¤`);
      return [];
    }

    const history = this.chatMediator.getMessageHistory();
    console.log(`${this.name} æŸ¥çœ‹æ¶ˆæ¯æ­·å²:`);
    history.forEach(msg => console.log(`  ${msg}`));
    return history;
  }

  // åŠ å…¥èŠå¤©å®¤
  joinChatRoom(chatRoom) {
    this.chatMediator = chatRoom;
    chatRoom.addUser(this);
  }

  // é›¢é–‹èŠå¤©å®¤
  leaveChatRoom() {
    if (this.chatMediator) {
      this.chatMediator.removeUser(this);
      this.chatMediator = null;
    }
  }
}

// å…·é«”çµ„ä»¶ï¼šé«˜ç´šç”¨æˆ¶
class AdminUser extends User {
  constructor(name) {
    super(name);
    this.isAdmin = true;
  }

  // ç®¡ç†å“¡å¯ä»¥è¸¢å‡ºç”¨æˆ¶
  kickUser(userName) {
    if (!this.chatMediator) {
      console.log(`${this.name}: å°šæœªåŠ å…¥èŠå¤©å®¤`);
      return;
    }

    const user = this.chatMediator.users.find(user => user.name === userName);
    if (user && !user.isAdmin) {
      console.log(`ç®¡ç†å“¡ ${this.name} å°‡ ${userName} è¸¢å‡ºèŠå¤©å®¤`);
      user.leaveChatRoom();
    } else if (user && user.isAdmin) {
      console.log(`${this.name}: ç„¡æ³•è¸¢å‡ºå…¶ä»–ç®¡ç†å“¡`);
    } else {
      console.log(`${this.name}: æ‰¾ä¸åˆ°ç”¨æˆ¶ ${userName}`);
    }
  }

  // ç®¡ç†å“¡å¯ä»¥æ¸…é™¤èŠå¤©å®¤æ­·å²è¨˜éŒ„
  clearChatHistory() {
    if (!this.chatMediator) {
      console.log(`${this.name}: å°šæœªåŠ å…¥èŠå¤©å®¤`);
      return;
    }

    console.log(`ç®¡ç†å“¡ ${this.name} æ¸…é™¤äº†èŠå¤©å®¤æ­·å²è¨˜éŒ„`);
    this.chatMediator.messageHistory = [];
    this.chatMediator.broadcastSystemMessage('èŠå¤©å®¤æ­·å²è¨˜éŒ„å·²è¢«ç®¡ç†å“¡æ¸…é™¤');
  }

  // ç®¡ç†å“¡å¯ä»¥ç™¼å¸ƒå…¬å‘Š
  makeAnnouncement(message) {
    if (!this.chatMediator) {
      console.log(`${this.name}: å°šæœªåŠ å…¥èŠå¤©å®¤`);
      return;
    }

    console.log(`ç®¡ç†å“¡ ${this.name} ç™¼å¸ƒå…¬å‘Š: ${message}`);
    this.chatMediator.broadcastSystemMessage(`å…¬å‘Š: ${message}`);
  }
}

// ä½¿ç”¨ç¤ºä¾‹
console.log('===== èŠå¤©å®¤ä»²ä»‹è€…æ¨¡å¼ç¤ºä¾‹ =====\n');

// å‰µå»ºèŠå¤©å®¤
const techChatRoom = new ChatRoom('æŠ€è¡“è¨è«–å€');

// å‰µå»ºç”¨æˆ¶
const alice = new User('Alice');
const bob = new User('Bob');
const charlie = new User('Charlie');
const admin = new AdminUser('Admin');

// ç”¨æˆ¶åŠ å…¥èŠå¤©å®¤
alice.joinChatRoom(techChatRoom);
bob.joinChatRoom(techChatRoom);
charlie.joinChatRoom(techChatRoom);
admin.joinChatRoom(techChatRoom);

console.log('\n===== ä¸€èˆ¬å°è©± =====');
// ç™¼é€æ¶ˆæ¯
alice.send('å¤§å®¶å¥½ï¼Œæœ‰äººçŸ¥é“å¦‚ä½•ä½¿ç”¨ä»²ä»‹è€…æ¨¡å¼å—ï¼Ÿ');
bob.send('é€™æ˜¯ä¸€ç¨®è¨­è¨ˆæ¨¡å¼ï¼Œç”¨æ–¼æ¸›å°‘å°è±¡ä¹‹é–“çš„ç›´æ¥ä¾è³´é—œä¿‚');
charlie.send('æ˜¯çš„ï¼Œå®ƒé€šéä¸€å€‹ä¸­ä»‹å°è±¡ä¾†å”èª¿å¤šå€‹å°è±¡ä¹‹é–“çš„äº’å‹•');

console.log('\n===== ç§èŠå°è©± =====');
// ç§èŠ
alice.sendPrivate('ä½ èƒ½è©³ç´°è§£é‡‹ä¸€ä¸‹å—ï¼Ÿ', 'Bob');
bob.sendPrivate('ç•¶ç„¶ï¼Œè®“æˆ‘ç™¼ä½ ä¸€äº›åƒè€ƒè³‡æ–™', 'Alice');

console.log('\n===== ç®¡ç†å“¡åŠŸèƒ½ =====');
// ç®¡ç†å“¡åŠŸèƒ½
admin.makeAnnouncement('ä»Šæ™šç³»çµ±å°‡é€²è¡Œç¶­è­·ï¼Œè«‹å¤§å®¶ä¿å­˜é‡è¦å°è©±');
admin.kickUser('Charlie');  // è¸¢å‡ºCharlie

console.log('\n===== æŸ¥çœ‹ç”¨æˆ¶å’Œæ­·å² =====');
// æŸ¥çœ‹åœ¨ç·šç”¨æˆ¶
bob.viewOnlineUsers();

// æŸ¥çœ‹æ¶ˆæ¯æ­·å²
alice.viewMessageHistory();

console.log('\n===== é›¢é–‹èŠå¤©å®¤ =====');
// é›¢é–‹èŠå¤©å®¤
bob.leaveChatRoom();
alice.send('é‚„æœ‰äººåœ¨å—ï¼Ÿ');
```

##### ç¸½çµä¸€ä¸‹ Mediator Pattern çš„ä½¿ç”¨é—œéµ

1. **é™ä½è€¦åˆåº¦**ï¼šçµ„ä»¶ä¹‹é–“ç„¡éœ€ç›´æ¥äº†è§£å°æ–¹ï¼Œè€Œæ˜¯é€šéä»²ä»‹è€…é€²è¡Œé€šä¿¡
2. **é›†ä¸­æ§åˆ¶**ï¼šäº¤äº’é‚è¼¯é›†ä¸­åœ¨ä»²ä»‹è€…ä¸­ï¼Œæ˜“æ–¼ç®¡ç†è¤‡é›œçš„äº’å‹•
3. **ç°¡åŒ–ç¶­è­·**ï¼šç•¶éœ€è¦æ”¹è®Šå°è±¡é–“çš„äº¤äº’æ™‚ï¼Œåªéœ€ä¿®æ”¹ä»²ä»‹è€…è€Œä¸æ˜¯å¤šå€‹å°è±¡
4. **å–®ä¸€è·è²¬**ï¼šå°‡ã€Œçµ„ä»¶é–“å¦‚ä½•äº’å‹•ã€çš„è²¬ä»»å¾çµ„ä»¶æœ¬èº«ç§»åˆ°å°ˆç”¨çš„ä»²ä»‹è€…é¡ä¸­

---

### 6. è²¬ä»»éˆæ¨¡å¼ï¼ˆChain of Responsibility Patternï¼‰

è²¬ä»»éˆå°±åƒæ˜¯ã€Œä¸Ÿå·¥ä½œä¸‹å»ï¼Œç„¶å¾Œè®“ä¸€æ¢ç·šä¸Šçš„äººè¼ªæµçœ‹è¦ä¸è¦è™•ç†ã€ã€‚

ä½ å ±äº†ä¸€å¼µ 700 å¡Šçš„å–®å­ï¼Œå°ä¸»ç®¡çœ‹åˆ°èªªï¼šã€Œé€™æˆ‘å¯ä»¥è™•ç†ã€ï¼Œå°±ç°½äº†ï¼›å¦‚æœæ˜¯ 8000ï¼Œä»–æœƒèªªï¼šã€Œå¤ªå¤§æ¢äº†ï¼Œæˆ‘è™•ç†ä¸äº†ã€ï¼Œç„¶å¾Œäº¤çµ¦ä¸Šé¢çš„äººã€‚é€™æ¨£ä¸€å±¤ä¸€å±¤å¾€ä¸Šå‚³ï¼Œå°±æ˜¯è²¬ä»»éˆã€‚

```c
// æŠ½è±¡ handler
class Handler {
  setNext(handler) {
    this.next = handler;
    return handler; // æ–¹ä¾¿éˆå¼å¯«æ³•
  }

// ä¸‰å€‹è«‹å‡é—œå¡
  handle(request) {
    if (this.next) {
      return this.next.handle(request);
    } else {
      console.log("âŒ æ²’æœ‰äººèƒ½è™•ç†é€™å€‹è«‹æ±‚");
    }
  }
}

class TeamLead extends Handler {
  handle(request) {
    if (request.days <= 1) {
      console.log(`âœ… å°çµ„é•·æ‰¹å‡†äº† ${request.name} è«‹ ${request.days} å¤©å‡`);
    } else {
      console.log(`â¡ï¸ å°çµ„é•·ç„¡æ³•è™•ç† ${request.days} å¤©ï¼Œå¾€ä¸Šäº¤`);
      super.handle(request);
    }
  }
}

class Manager extends Handler {
  handle(request) {
    if (request.days <= 3) {
      console.log(`âœ… ç¶“ç†æ‰¹å‡†äº† ${request.name} è«‹ ${request.days} å¤©å‡`);
    } else {
      console.log(`â¡ï¸ ç¶“ç†ä¹Ÿä¸èƒ½æ‰¹ ${request.days} å¤©ï¼Œäº¤çµ¦è€é—†`);
      super.handle(request);
    }
  }
}

class CEO extends Handler {
  handle(request) {
    console.log(`ğŸ‘‘ è€é—†èªª OKï¼${request.name} å¯ä»¥è«‹ ${request.days} å¤©`);
  }
}

// çµ„è£è²¬ä»»éˆ
const teamLead = new TeamLead();
const manager = new Manager();
const ceo = new CEO();

teamLead.setNext(manager).setNext(ceo);

// ä½¿ç”¨
teamLead.handle({ name: "å°æ˜", days: 1 });
// âœ… å°çµ„é•·æ‰¹å‡†äº† å°æ˜ è«‹ 1 å¤©å‡

teamLead.handle({ name: "å°ç¾", days: 2 });
// â¡ï¸ å°çµ„é•·ç„¡æ³•è™•ç† 2 å¤©ï¼Œå¾€ä¸Šäº¤
// âœ… ç¶“ç†æ‰¹å‡†äº† å°ç¾ è«‹ 2 å¤©å‡

teamLead.handle({ name: "é˜¿å¼·", days: 5 });
// â¡ï¸ å°çµ„é•·ç„¡æ³•è™•ç† 5 å¤©ï¼Œå¾€ä¸Šäº¤
// â¡ï¸ ç¶“ç†ä¹Ÿä¸èƒ½æ‰¹ 5 å¤©ï¼Œäº¤çµ¦è€é—†
// ğŸ‘‘ è€é—†èªª OKï¼é˜¿å¼· å¯ä»¥è«‹ 5 å¤©

```

##### ç¸½çµä¸€ä¸‹ Chain of Responsibility Pattern çš„ä½¿ç”¨é—œéµ

1. è§£è€¦è«‹æ±‚ç™¼é€è€…å’Œæ¥æ”¶è€…ï¼šç™¼é€è€…åªéœ€çŸ¥é“éˆçš„ç¬¬ä¸€å€‹ç¯€é»ï¼Œä¸éœ€è¦çŸ¥é“èª°æœƒè™•ç†è«‹æ±‚
2. å‹•æ…‹çµ„ç¹”è™•ç†æµç¨‹ï¼šå¯ä»¥åœ¨é‹è¡Œæ™‚å‹•æ…‹æ”¹è®Šéˆçš„çµæ§‹ï¼Œå¢åŠ ã€ç§»é™¤æˆ–é‡æ’åºè™•ç†è€…
3. åˆ†æ•£è™•ç†è²¬ä»»ï¼šæ¯å€‹è™•ç†è€…åªé—œæ³¨è‡ªå·±èƒ½è™•ç†çš„è«‹æ±‚é¡å‹ï¼Œç¬¦åˆå–®ä¸€è·è²¬åŸå‰‡
4. éˆæ´»çš„è«‹æ±‚è™•ç†ï¼šå¯ä»¥è®“è«‹æ±‚è¢«å¤šå€‹è™•ç†è€…éƒ¨åˆ†è™•ç†ï¼Œæˆ–è€…æ±ºå®šåœ¨æŸå€‹é»çµ‚æ­¢è™•ç†

---

### 7. è¿­ä»£å™¨æ¨¡å¼ï¼ˆIterator Patternï¼‰

æƒ³åƒä½ æœ‰ä¸€å€‹è£æ»¿ç³–æœçš„ç½å­ï¼ˆå¯èƒ½æ˜¯é™£åˆ—ã€ç‰©ä»¶ã€Setã€Mapï¼‰ï¼Œä½ æƒ³è¦ä¸€é¡†ä¸€é¡†åœ°æ‹¿å‡ºä¾†åƒï¼Œä½†ä½ ä¸åœ¨æ„è£¡é¢æ˜¯æ€éº¼å­˜çš„ï¼Œä¹Ÿä¸æƒ³è‡ªå·±å»ç®— index æˆ–ç”¨ for è¿´åœˆã€‚

é€™æ™‚å€™ä½ å°±éœ€è¦ä¸€å€‹äººï¼ˆIteratorï¼‰ï¼Œæ¯æ¬¡ä½ èªªã€Œä¸‹ä¸€å€‹ã€ä»–å°±å¹«ä½ æ‹¿ä¸€é¡†çµ¦ä½ ï¼Œè€Œä¸”é‚„æœƒè²¼å¿ƒå‘Šè¨´ä½ ã€Œæ²’äº†å“¦ï¼ã€

é€™ç¨®ã€Œé€å€‹è¨ªå•é›†åˆå…§å®¹ã€ä½†åˆä¸æš´éœ²é›†åˆå…§éƒ¨å¯¦ä½œç´°ç¯€çš„æ–¹å¼ï¼Œå°±æ˜¯è¿­ä»£å™¨æ¨¡å¼ã€‚

æˆ‘å€‘å¸¸å¸¸ç”¨åˆ°çš„ for of å°±æ˜¯è¿­ä»£å™¨

```c
const arr = [10, 20, 30];
for (const item of arr) {
  console.log(item); // 10, 20, 30
}
```

è‡ªå·±åšä¸€å€‹è¿­ä»£å™¨å¯ä»¥ç”¨ `Symbol.iterator`ï¼Œæˆ‘å€‘å…ˆä¾†è§£é‡‹é€™æ˜¯ä»€éº¼ã€‚

Symbol.iterator æ˜¯ JavaScript çš„ä¸€å€‹å…§å»ºç¬¦è™Ÿï¼ˆsymbolï¼‰ï¼Œå®ƒç”¨ä¾†å‘Šè¨´ JS ä½ çš„ç‰©ä»¶ã€Œå¯ä»¥è¢«è¿­ä»£ã€ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ç”¨ for...of å»è·‘ä¸€åœˆã€‚

å®ƒæ˜¯ä¸€å€‹å‡½å¼ï¼Œå›å‚³ä¸€å€‹ã€Œè¿­ä»£å™¨ç‰©ä»¶ã€ï¼Œé€™å€‹ç‰©ä»¶è¦æœ‰å€‹ next() æ–¹æ³•ã€‚

```c
const myIterable = {
  data: ['ğŸ•', 'ğŸ”', 'ğŸŒ®'],

  [Symbol.iterator]() {
    let index = 0;
    const items = this.data;

    return {
      next() {
        if (index < items.length) {
          return { value: items[index++], done: false };
        } else {
          return { done: true };
        }
      }
    };
  }
};

for (const food of myIterable) {
  console.log('åƒåˆ°ï¼š', food);
}
```

è¼¸å‡ºï¼š

```
åƒåˆ°ï¼š ğŸ•
åƒåˆ°ï¼š ğŸ”
åƒåˆ°ï¼š ğŸŒ®
```

å¥½ï¼Œé‚£æˆ‘å€‘ç”¨å‡½å¼å»ºæ§‹çš„æ–¹å¼ä¾†æ‰“é€ ä¸€å€‹è¿­ä»£å™¨

```c
// ç³–æœç½ï¼ˆè‡ªè¨‚é›†åˆï¼‰
function CandyBox(candies) {
  this.candies = candies;

  // æä¾›è‡ªå·±çš„ iterator
  this[Symbol.iterator] = function () {
    let index = 0;
    const candies = this.candies;

    return {
      next() {
        if (index < candies.length) {
          return { value: candies[index++], done: false };
        } else {
          return { done: true };
        }
      }
    };
  };
}

// ä½¿ç”¨å®ƒ
const myBox = new CandyBox(['ğŸ¬', 'ğŸ­', 'ğŸ«']);

for (const candy of myBox) {
  console.log('æ‹¿åˆ°ç³–æœ:', candy);
}
```

è¼¸å‡ºï¼š

```
æ‹¿åˆ°ç³–æœ: ğŸ¬
æ‹¿åˆ°ç³–æœ: ğŸ­
æ‹¿åˆ°ç³–æœ: ğŸ«
```

##### ç¸½çµä¸€ä¸‹ Iterator Pattern çš„é‡é»

1. è¿­ä»£å™¨å°±æ˜¯å¹«ä½ ã€Œä¸€å€‹ä¸€å€‹æ‹¿è³‡æ–™ã€çš„å¹«æ‰‹
2. ä¸ç”¨ä½ è‡ªå·±ç®¡ indexã€é•·åº¦ã€å…§éƒ¨çµæ§‹
3. ä½ åªè¦å«ã€Œnext()ã€ï¼Œå®ƒå°±æœƒèªªï¼šã€Œé€™æ˜¯ä½ çš„è³‡æ–™ã€ã€Œæ²’è³‡æ–™äº†ã€
4. åœ¨ JS è£¡é…åˆ for...of æœ€æ–¹ä¾¿

---

æˆ‘å€‘ä»¥ä¸Šç¸½å…±ä»‹ç´¹äº†ä¸ƒç¨®è¡Œç‚ºå‹æ¨¡å¼ï¼Œä½†ä»–å…¶å¯¦é‚„æœ‰å¾ˆå¤šï¼Œä¸‹é¢ç°¡å–®ä»‹ç´¹äº†ä¸‹å¸¸è¦‹çš„è¡Œç‚ºå‹æ¨¡å¼ä¸¦å°ç…§å…¶æ‡‰ç”¨æƒ…å¢ƒã€‚

| æ¨¡å¼åç¨±                | ç°¡ä»‹ï¼ˆå£èªåŒ–ï¼‰                                                     | å¸¸è¦‹æ‡‰ç”¨æƒ…å¢ƒ                                        |
| ----------------------- | ------------------------------------------------------------------ | --------------------------------------------------- |
| Chain of Responsibility | åƒæ˜¯å®¢æœè½‰æ¥ï¼Œæ¯å€‹è™•ç†è€…éƒ½æœ‰æ©Ÿæœƒè™•ç†è«‹æ±‚ï¼Œæ²’è™•ç†å°±å¾€ä¸‹ä¸€å€‹å‚³ã€‚     | è«‹æ±‚å¯©æ ¸æµç¨‹ã€Middleware è™•ç†éˆ                     |
| Command                 | æŠŠã€Œè¡Œç‚ºã€åŒ…æˆç‰©ä»¶ï¼Œå¯ä»¥å„²å­˜ã€æ’ç¨‹æˆ–å–æ¶ˆã€‚                         | Undo/Redo ç³»çµ±ã€æŒ‰éˆ•é»æ“Šè§¸ç™¼å‹•ä½œ                    |
| Iterator                | æä¾›ä¸€ç¨®æ–¹æ³•ï¼Œè®“ä½ é€ä¸€è¨ªå•é›†åˆå…ƒç´ ï¼Œä¸æš´éœ²é›†åˆå…§éƒ¨å¯¦ä½œç´°ç¯€ã€‚       | è‡ªè¨‚å¯è¿­ä»£è³‡æ–™çµæ§‹ã€éæ­· Tree/Graph                 |
| Mediator                | åƒå€‹ä¸­ä»‹äººï¼Œè² è²¬å”èª¿å„å€‹ç‰©ä»¶é–“çš„æºé€šï¼Œå¤§å®¶ä¸ç›´æ¥è¯çµ¡å½¼æ­¤ã€‚         | Chatroom ç³»çµ±ã€è¡¨å–®æ¬„ä½ä¾åºå•Ÿç”¨ï¼ˆæ¬„ä½é–“ä¾è³´ï¼‰       |
| Memento                 | å­˜å–ç‰©ä»¶çš„ç‹€æ…‹å¿«ç…§ï¼Œæ—¥å¾Œå¯ä»¥å¾©åŸã€‚                                 | éŠæˆ²å„²å­˜é»ã€æ–‡å­—ç·¨è¼¯å™¨çš„å¾©åŸåŠŸèƒ½                    |
| Observer                | ä¸€ç¾¤è¨‚é–±è€…æœƒè¢«é€šçŸ¥æŸä»¶äº‹ç™¼ç”Ÿï¼Œåƒæ˜¯è¿½è¹¤è‚¡ç¥¨åƒ¹æ ¼ä¸€æ¨£ã€‚               | UI å…ƒä»¶è‡ªå‹•æ›´æ–°ã€äº‹ä»¶ç™¼å¸ƒç³»çµ±ï¼ˆEvent Busã€pub/subï¼‰ |
| State                   | æ ¹æ“šå…§éƒ¨ç‹€æ…‹ä¸åŒï¼Œç‰©ä»¶è¡Œç‚ºæœƒè®Šã€‚                                   | è¨‚å–®æµç¨‹ç®¡ç†ã€è§’è‰²è¡Œç‚ºåˆ‡æ›                          |
| Strategy                | æŠŠæ¼”ç®—æ³•æ‹†å‡ºä¾†ï¼Œæƒ³æ›æ¼”ç®—æ³•å°±æ›ä¸€é¡†ã€‚                               | æ’åºç­–ç•¥åˆ‡æ›ã€ä»˜æ¬¾æ–¹å¼åˆ‡æ›ã€æ‰“æ€ª AI çš„ç­–ç•¥æ¨¡å¼      |
| Template Method         | ä¸€å€‹æµç¨‹å›ºå®šï¼Œä½†æ­¥é©Ÿç´°ç¯€å¯ä»¥è®“å­é¡å¯¦ä½œã€‚                           | æª”æ¡ˆè½‰æª”æµç¨‹ã€å ±è¡¨ç”¢å‡ºæµç¨‹                          |
| Visitor                 | æŠŠè¦åŠ åœ¨ç‰©ä»¶ä¸Šçš„æ“ä½œæŠ½å‡ºä¾†ï¼Œè®“ä½ åœ¨ä¸å‹•åˆ°åŸæœ¬é¡åˆ¥çš„æƒ…æ³ä¸‹æ–°å¢è¡Œç‚ºã€‚ | ç·¨è­¯å™¨è™•ç† ASTã€ç•«åœ–ç¨‹å¼ä¸åŒå½¢ç‹€çš„ visitor          |
| Interpreter             | é‡å°èªæ³•å’Œèªè¨€è¨­è¨ˆï¼Œåšå‡ºå¯è§£è®€çš„ç³»çµ±ã€‚                             | è¨ˆç®—å™¨ã€æ¢ä»¶éæ¿¾èªæ³•ï¼ˆåƒæ˜¯æœå°‹èªæ³•è§£æï¼‰            |
